/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 1.0.0-beta.1
 *
 * Copyright 2022 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],o):(e="undefined"!=typeof globalThis?globalThis:e||self).ChartZoom=o(e.Chart,e.Chart.helpers)}(this,(function(e,o){"use strict";var n={},t=n.zoomFunctions=n.zoomFunctions||{},a=n.panFunctions=n.panFunctions||{};function i(e,o){var n=e.$zoom;n._options=o;var t=n._node,a=o.zoom&&o.zoom.enabled,i=o.zoom.drag;a&&!i?t.addEventListener("wheel",n._wheelHandler):t.removeEventListener("wheel",n._wheelHandler),a&&i?(t.addEventListener("mousedown",n._mouseDownHandler),t.ownerDocument.addEventListener("mouseup",n._mouseUpHandler)):(t.removeEventListener("mousedown",n._mouseDownHandler),t.removeEventListener("mousemove",n._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler))}function r(e){var n=e.$zoom._originalOptions;o.each(e.scales,(function(e){n[e.id]||(n[e.id]=o.clone(e.options))})),o.each(n,(function(o,t){e.scales[t]||delete n[t]}))}function m(e,o,n){return void 0===e||("string"==typeof e?-1!==e.indexOf(o):"function"==typeof e&&-1!==e({chart:n}).indexOf(o))}function l(e,n,t,a){if(e.enabled&&e.overScaleMode){var i=function(e,o,n){for(var t=n.scales,a=Object.keys(t),i=0;i<a.length;i++){var r=t[a[i]];if(o>=r.top&&o<=r.bottom&&e>=r.left&&e<=r.right)return r}return null}(n,t,a),r="function"==typeof e.overScaleMode?e.overScaleMode({chart:a},i):e.overScaleMode;if(i&&m(r,i.axis,a))return[i];var l=[];return o.each(a.scales,(function(e){m(r,e.axis,a)||l.push(e)})),l}return null}function s(e,n){if(e.scaleAxes&&e.rangeMax&&!o.isNullOrUndef(e.rangeMax[e.scaleAxes])){const o=e.rangeMax[e.scaleAxes];n>o&&(n=o)}return n}function c(e,n){if(e.scaleAxes&&e.rangeMin&&!o.isNullOrUndef(e.rangeMin[e.scaleAxes])){const o=e.rangeMin[e.scaleAxes];n<o&&(n=o)}return n}function u(e,o,n){const t=e.max-e.min,a=t*(o-1),i=e.isHorizontal()?n.x:n.y,r=(e.getValueForPixel(i)-e.min)/t;return{min:a*r,max:a*(1-r)}}function d(e,o,n,t){const a=u(e,o,n);e.options.min=c(t,e.min+a.min),e.options.max=s(t,e.max-a.max)}const f=e=>0===e||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);function p(e,o,n,a){var i=t[e.type];i&&i(e,o,n,a)}function v(e,n,t,a,i,s){var c=e.chartArea;a||(a={x:(c.left+c.right)/2,y:(c.top+c.bottom)/2});var u=e.$zoom._options.zoom;if(u.enabled){r(e);var d,f="function"==typeof u.mode?u.mode({chart:e}):u.mode;d="xy"===f&&void 0!==i?i:"xy";var v=l(u,a.x,a.y,e);o.each(v||e.scales,(function(o){o.isHorizontal()&&m(f,"x",e)&&m(d,"x",e)?(u.scaleAxes="x",p(o,n,a,u)):!o.isHorizontal()&&m(f,"y",e)&&m(d,"y",e)&&(u.scaleAxes="y",p(o,t,a,u))})),s?(e.options.animation.zoom||(e.options.animation.zoom={duration:s,easing:"easeOutQuad"}),e.update("zoom")):e.update("none"),"function"==typeof u.onZoom&&u.onZoom({chart:e})}}function h(e,o,n){const t=e.options,a=e.min,i=e.max,r=e.getValueForPixel(e.getPixelForValue(a)-o),m=e.getValueForPixel(e.getPixelForValue(i)-o),l=c(n,r),u=s(n,m);let d;r>=l&&m<=u?(t.min=r,t.max=m):r<l?(d=a-l,t.min=l,t.max=i-d):m>u&&(d=u-i,t.max=u,t.min=a+d)}function g(e,o,n){const t=a[e.type];t&&t(e,o,n)}n.zoomFunctions.category=function(e,o,n,t){const a=e.getLabels(),i=a.length-1;e.min===e.max&&o<1&&(e.min>0?e.min--:e.max<i&&e.max++);const r=u(e,o,n);e.options.min=a[Math.max(0,c(t,e.min+f(r.min)))],e.options.max=a[Math.min(i,s(t,e.max-f(r.max)))]},n.zoomFunctions.time=d,n.zoomFunctions.linear=d,n.zoomFunctions.logarithmic=d,n.panFunctions.category=function(e,o,t){const a=e.getLabels(),i=a.length-1,r=Math.max(e.ticks.length,1),m=t.speed,l=Math.round(e.width/(r*m));let u,d=e.min;n.panCumulativeDelta+=o,d=n.panCumulativeDelta>l?Math.max(0,d-1):n.panCumulativeDelta<-l?Math.min(i-r+1,d+1):d,n.panCumulativeDelta=d!==e.min?0:n.panCumulativeDelta,u=Math.min(i,d+r-1),e.options.min=c(t,a[d]),e.options.max=s(t,a[u])},n.panFunctions.time=h,n.panFunctions.linear=h,n.panFunctions.logarithmic=h,n.panCumulativeDelta=0;var x={id:"zoom",defaults:{pan:{enabled:!1,mode:"xy",speed:20,threshold:10,modifierKey:null},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1,wheelModifierKey:null}},start:function(e,n,t){e.$zoom={_originalOptions:{}};var a=e.$zoom._node=e.ctx.canvas;i(e,t);var s=e.$zoom._options;e.$zoom._mouseDownHandler=function(o){a.addEventListener("mousemove",e.$zoom._mouseMoveHandler),e.$zoom._dragZoomStart=o},e.$zoom._mouseMoveHandler=function(o){e.$zoom._dragZoomStart&&(e.$zoom._dragZoomEnd=o,e.update("none"))},e.$zoom._mouseUpHandler=function(o){if(e.$zoom._dragZoomStart){a.removeEventListener("mousemove",e.$zoom._mouseMoveHandler);var n=e.$zoom._dragZoomStart,t=n.target.getBoundingClientRect().left,i=Math.min(n.clientX,o.clientX)-t,r=Math.max(n.clientX,o.clientX)-t,l=n.target.getBoundingClientRect().top,c=Math.min(n.clientY,o.clientY)-l,u=r-i,d=Math.max(n.clientY,o.clientY)-l-c;e.$zoom._dragZoomStart=null,e.$zoom._dragZoomEnd=null;var f=s.zoom&&s.zoom.threshold||0;if(!(u<=f&&d<=f)){var p=e.chartArea,h=e.$zoom._options.zoom,g=p.right-p.left,x=m(h.mode,"x",e)&&u?1+(g-u)/g:1,z=p.bottom-p.top,y=m(h.mode,"y",e);v(e,x,y&&d?1+(z-d)/z:1,{x:(i-p.left)/(1-u/g)+p.left,y:(c-p.top)/(1-d/z)+p.top},void 0,h.drag.animationDuration),"function"==typeof h.onZoomComplete&&h.onZoomComplete({chart:e})}}};var c=null;e.$zoom._wheelHandler=function(o){var n=e.$zoom._options.zoom;if(n&&n.wheelModifierKey&&!o[n.wheelModifierKey+"Key"])"function"==typeof n.onZoomRejected&&n.onZoomRejected({chart:e,event:o});else if(o.cancelable&&o.preventDefault(),void 0!==o.deltaY){var t=o.target.getBoundingClientRect(),a={x:o.clientX-t.left,y:o.clientY-t.top},i=n.speed;o.deltaY>=0&&(i=-i),v(e,1+i,1+i,a),clearTimeout(c),c=setTimeout((function(){"function"==typeof n.onZoomComplete&&n.onZoomComplete({chart:e})}),250)}};var u=e.$zoom._options.pan||{},d=null,f=null,p=null;e.$zoom.panHandler=function(n){if(null!==d&&null!==f){var t=n.deltaX-d,a=n.deltaY-f;d=n.deltaX,f=n.deltaY,function(e,n,t,a){r(e);var i=e.$zoom._options.pan;if(i.enabled){var l="function"==typeof i.mode?i.mode({chart:e}):i.mode;o.each(a||e.scales,(function(o){o.isHorizontal()&&m(l,"x",e)&&0!==n?(i.scaleAxes="x",g(o,n,i)):!o.isHorizontal()&&m(l,"y",e)&&0!==t&&(i.scaleAxes="y",g(o,t,i))})),e.update("none"),"function"==typeof i.onPan&&i.onPan({chart:e})}}(e,t,a,p)}},e.$zoom.panStartHandler=function(o){if(u.enabled){var n=o.target.getBoundingClientRect(),t=o.center.x-n.left,a=o.center.y-n.top;p=l(u,t,a,e)}d=0,f=0,e.$zoom.panHandler(o)},e.$zoom.panEndHandler=function(){p=null,d=null,f=null,"function"==typeof u.onPanComplete&&u.onPanComplete({chart:e})},e.resetZoom=function(){r(e);var n=e.$zoom._originalOptions;o.each(e.scales,(function(e){var o=e.options;n[e.id]?(o.min=n[e.id].min,o.max=n[e.id].max):(delete o.min,delete o.max)})),e.update()}},beforeUpdate:function(e,o,n){i(e,n)},beforeDatasetsDraw:function(e){var o=e.ctx;if(e.$zoom._dragZoomEnd){var n=function(e){for(var o=e.scales,n=Object.keys(o),t=0;t<n.length;t++){var a=o[n[t]];if(a.isHorizontal())return a}}(e),t=function(e){for(var o=e.scales,n=Object.keys(o),t=0;t<n.length;t++){var a=o[n[t]];if(!a.isHorizontal())return a}}(e),a=e.$zoom._dragZoomStart,i=e.$zoom._dragZoomEnd,r=n.left,l=n.right,s=t.top,c=t.bottom;if(m(e.$zoom._options.zoom.mode,"x",e)){var u=a.target.getBoundingClientRect().left;r=Math.min(a.clientX,i.clientX)-u,l=Math.max(a.clientX,i.clientX)-u}if(m(e.$zoom._options.zoom.mode,"y",e)){var d=a.target.getBoundingClientRect().top;s=Math.min(a.clientY,i.clientY)-d,c=Math.max(a.clientY,i.clientY)-d}var f=l-r,p=c-s,v=e.$zoom._options.zoom.drag;o.save(),o.beginPath(),o.fillStyle=v.backgroundColor||"rgba(225,225,225,0.3)",o.fillRect(r,s,f,p),v.borderWidth>0&&(o.lineWidth=v.borderWidth,o.strokeStyle=v.borderColor||"rgba(225,225,225)",o.strokeRect(r,s,f,p)),o.restore()}},stop:function(e){if(e.$zoom){var o=e.$zoom,n=o._node;n.removeEventListener("mousedown",o._mouseDownHandler),n.removeEventListener("mousemove",o._mouseMoveHandler),n.ownerDocument.removeEventListener("mouseup",o._mouseUpHandler),n.removeEventListener("wheel",o._wheelHandler),n.removeEventListener("click",o._ghostClickHandler),delete e.$zoom;var t=e._mc;t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy())}}};return e.Chart.register(x),x}));
